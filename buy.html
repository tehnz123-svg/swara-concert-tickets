<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buy Tickets</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        body {
            background-color: #1a0d00;
            color: #fff;
        }

        .form-section {
            background: #261a0d;
            padding: 2rem;
            border-radius: 10px;
            margin-top: 2rem;
        }
    </style>
</head>

<body>
    <div class="container form-section">
        <h2>Buy Tickets</h2>
        <form id="ticketForm">
            <div class="mb-3">
                <label for="fullName" class="form-label">Full Name</label>
                <input type="text" class="form-control" id="fullName" required>
            </div>
            <div class="mb-3">
                <label for="saNo" class="form-label">SA Number</label>
                <input type="text" class="form-control" id="saNo" required>
            </div>
            <div class="mb-3">
                <label for="email" class="form-label">Email</label>
                <input type="email" class="form-control" id="email" required>
            </div>
            <div class="mb-3">
                <label for="whatsapp" class="form-label">WhatsApp Number</label>
                <input type="tel" class="form-control" id="whatsapp" required>
            </div>
            <div class="mb-3">
                <label for="tickets" class="form-label">Number of Tickets</label>
                <input type="number" class="form-control" id="tickets" min="1" max="5" required>
            </div>
            <div id="additionalFields"></div>
            <div class="mb-3">
                <label for="receipt" class="form-label">Upload Payment Receipt</label>
                <input type="file" class="form-control" id="receipt" accept="image/*,application/pdf" required>
            </div>
            <button type="submit" class="btn btn-warning">Submit</button>
        </form>
    </div>
    <script>
        const ticketInput = document.getElementById('tickets');
        const additionalFields = document.getElementById('additionalFields');
        ticketInput.addEventListener('input', () => {
            const count = parseInt(ticketInput.value);
            additionalFields.innerHTML = '';
            for (let i = 1; i < count; i++) {
                additionalFields.innerHTML += `
          <div class="mb-3">
            <label class="form-label">Full Name for Ticket ${i + 1}</label>
            <input type="text" class="form-control" name="extra_name_${i}" required>
          </div>
          <div class="mb-3">
            <label class="form-label">SA Number for Ticket ${i + 1}</label>
            <input type="text" class="form-control" name="extra_sa_${i}" required>
          </div>
        `;
            }
        });

        // Replace form submission logic:
        document.getElementById('ticketForm').addEventListener('submit', async function (e) {
            e.preventDefault();

            const form = e.target;
            const file = form.receipt.files[0];
            const reader = new FileReader();

            reader.onload = async function () {
                const base64 = reader.result.split(',')[1];

                const payload = {
                    fullName: form.fullName.value,
                    saNo: form.saNo.value,
                    email: form.email.value,
                    whatsapp: form.whatsapp.value,
                    ticketCount: form.tickets.value,
                    additionalTickets: Array.from(document.querySelectorAll('[name^=extra_name_]')).map((el, i) => ({
                        fullName: el.value,
                        saNo: document.querySelector(`[name=extra_sa_${i + 1}]`).value
                    })),
                    receipt: {
                        filename: file.name,
                        mimeType: file.type,
                        content: base64
                    }
                };

                const res = await fetch('https://script.google.com/macros/s/AKfycbwgAyyFintNxQRAI14Kt_VJMqw0KMi9iUKC_rY5LTPx3z0BGjNQa-TY0Z0Q-64DqQEv5w/exec', {
                    method: 'POST',
                    body: JSON.stringify(payload),
                    headers: { 'Content-Type': 'application/json' }
                });

                const json = await res.json();
                if (json.status === 'success') {
                    alert('Successfully submitted!');
                    form.reset();
                } else {
                    alert('Submission failed: ' + json.message);
                }
            };

            reader.readAsDataURL(file);
        });

    </script>
</body>

</html>